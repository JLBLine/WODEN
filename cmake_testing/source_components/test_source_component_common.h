#include <math.h>
#include <unity.h>
#include <stdlib.h>
#include <complex.h>
#include <erfa.h>

#include "constants.h"
#include "woden_struct_defs.h"
#include "woden_precision_defs.h"
#include "FEE_primary_beam.h"

/*******************************************************************************
Here are a bunch of predefined arrays to be used
Some are inputs for tests, others are expected outputs
*******************************************************************************/

user_precision_t azs[] = {4.71238899, 4.71238899, 4.71238899, 4.71238899, 4.71238899,
               4.71238899, 4.71238899, 4.71238899, 4.71238899, 4.71238899,
               4.71238899, 4.71238899, 0.00000000, 0.00000000, 0.00000000,
               1.57079637, 1.57079637, 1.57079637, 1.57079637, 1.57079637,
               1.57079637, 1.57079637, 1.57079637, 1.57079637, 1.57079637,
               1.57079637, 1.57079637};
user_precision_t zas[] = {1.57079631, 1.57079631, 1.57079631, 1.04719766, 1.04719766,
               1.04719766, 0.78539832, 0.78539832, 0.78539832, 0.52359898,
               0.52359898, 0.52359898, 0.00000000, 0.00000000, 0.00000000,
               0.52359875, 0.52359875, 0.52359875, 0.78539820, 0.78539820,
               0.78539820, 1.04719760, 1.04719760, 1.04719760, 1.57079637,
               1.57079637, 1.57079637};

user_precision_t sin_para_angs[] = {1.00000000, 1.00000000, 1.00000000, 1.00000000,
                         1.00000000, 1.00000000, 1.00000000, 1.00000000,
                         1.00000000, 1.00000000, 1.00000000, 1.00000000,
                         0.00000000, 0.00000000, 0.00000000, -1.00000000,
                         -1.00000000, -1.00000000, -1.00000000, -1.00000000,
                         -1.00000000, -1.00000000, -1.00000000, -1.00000000,
                         -1.00000000, -1.00000000, -1.00000000};

user_precision_t cos_para_angs[] = {0.00000000, 0.00000000, 0.00000000, 0.00000000,
                         0.00000000, 0.00000000, 0.00000000, 0.00000000,
                         0.00000000, 0.00000000, 0.00000000, 0.00000000,
                         1.00000000, 1.00000000, 1.00000000, 0.00000000,
                         0.00000000, 0.00000000, 0.00000000, 0.00000000,
                         0.00000000, 0.00000000, 0.00000000, 0.00000000,
                         0.00000000, 0.00000000, 0.00000000};

double analy_expec_J00[] = { 0.00000002, 0.52576818, 0.73128019,
  0.88075472, 1.00000000, 0.88075483, 0.73128027, 0.52576824, -0.00000005,
  0.00000002, 0.61822932, 0.81629589, 0.93152102, 1.00000000, 0.93152109,
  0.81629596, 0.61822938, -0.00000006, 0.00000002, 0.52576818, 0.73128019,
  0.88075472, 1.00000000, 0.88075483, 0.73128027, 0.52576824, -0.00000005,
  0.00000002, 0.61822932, 0.81629589, 0.93152102, 1.00000000, 0.93152109,
  0.81629596, 0.61822938, -0.00000006, 0.00000002, 0.52576818, 0.73128019,
  0.88075472, 1.00000000, 0.88075483, 0.73128027, 0.52576824, -0.00000005,
  0.00000002, 0.61822932, 0.81629589, 0.93152102, 1.00000000, 0.93152109,
  0.81629596, 0.61822938, -0.00000006 };

double analy_expec_J11[] = { 0.00000000, 0.26288404, 0.51709310,
  0.76275588, 1.00000000, 0.76275607, 0.51709322, 0.26288410, -0.00000000,
  0.00000000, 0.30911460, 0.57720827, 0.80672078, 1.00000000, 0.80672094,
  0.57720839, 0.30911466, -0.00000000, 0.00000000, 0.26288404, 0.51709310,
  0.76275588, 1.00000000, 0.76275607, 0.51709322, 0.26288410, -0.00000000,
  0.00000000, 0.30911460, 0.57720827, 0.80672078, 1.00000000, 0.80672094,
  0.57720839, 0.30911466, -0.00000000, 0.00000000, 0.26288404, 0.51709310,
  0.76275588, 1.00000000, 0.76275607, 0.51709322, 0.26288410, -0.00000000,
  0.00000000, 0.30911460, 0.57720827, 0.80672078, 1.00000000, 0.80672094,
  0.57720839, 0.30911466, -0.00000000 };

double fee_expec_J00_re[] = { 0.00267454, -0.04803085, -0.19898539, -0.09462145,
   0.97041277, -0.09457762, -0.19897082, -0.04808879, 0.00267138, 0.00267454,
   -0.04803085, -0.19898539, -0.09462145, 0.97041277, -0.09457762, -0.19897082,
   -0.04808879, 0.00267138, 0.00267454, -0.04803085, -0.19898539, -0.09462145,
   0.97041277, -0.09457762, -0.19897082, -0.04808879, 0.00267138, 0.00267454,
   -0.04803085, -0.19898539, -0.09462145, 0.97041277, -0.09457762, -0.19897082,
   -0.04808879, 0.00267138, 0.00267454, -0.04803085, -0.19898539, -0.09462145,
   0.97041277, -0.09457762, -0.19897082, -0.04808879, 0.00267138, 0.00267454,
   -0.04803085, -0.19898539, -0.09462145, 0.97041277, -0.09457762, -0.19897082,
   -0.04808879, 0.00267138 };

double fee_expec_J00_im[] = { 0.00004019, -0.00887804, -0.03244147, -0.01880127,
   0.24145197, -0.01878724, -0.03245273, -0.00890450, 0.00004090, 0.00004019,
   -0.00887804, -0.03244147, -0.01880127, 0.24145197, -0.01878724, -0.03245273,
   -0.00890450, 0.00004090, 0.00004019, -0.00887804, -0.03244147, -0.01880127,
   0.24145197, -0.01878724, -0.03245273, -0.00890450, 0.00004090, 0.00004019,
   -0.00887804, -0.03244147, -0.01880127, 0.24145197, -0.01878724, -0.03245273,
   -0.00890450, 0.00004090, 0.00004019, -0.00887804, -0.03244147, -0.01880127,
   0.24145197, -0.01878724, -0.03245273, -0.00890450, 0.00004090, 0.00004019,
   -0.00887804, -0.03244147, -0.01880127, 0.24145197, -0.01878724, -0.03245273,
   -0.00890450, 0.00004090};

double fee_expec_J01_re[] = { 0.00134114, -0.02100277, -0.07075578, -0.02370724,
  -0.00025053, 0.02387903, 0.07079324, 0.02086936, -0.00134781, 0.00134114,
   -0.02100277, -0.07075578, -0.02370724, -0.00025053, 0.02387903, 0.07079324,
    0.02086936, -0.00134781, 0.00134114, -0.02100277, -0.07075578, -0.02370724,
    -0.00025053, 0.02387903, 0.07079324, 0.02086936, -0.00134781, 0.00134114,
    -0.02100277, -0.07075578, -0.02370724, -0.00025053, 0.02387903, 0.07079324,
     0.02086936, -0.00134781, 0.00134114, -0.02100277, -0.07075578, -0.02370724,
     -0.00025053, 0.02387903, 0.07079324, 0.02086936, -0.00134781, 0.00134114,
     -0.02100277, -0.07075578, -0.02370724, -0.00025053, 0.02387903, 0.07079324,
      0.02086936, -0.00134781 };

double fee_expec_J01_im[] = { 0.00002118, -0.00390426, -0.01155728, -0.00469832,
   -0.00012354, 0.00475597, 0.01152525, 0.00384283, -0.00001993, 0.00002118,
   -0.00390426, -0.01155728, -0.00469832, -0.00012354, 0.00475597, 0.01152525,
    0.00384283, -0.00001993, 0.00002118, -0.00390426, -0.01155728, -0.00469832,
    -0.00012354, 0.00475597, 0.01152525, 0.00384283, -0.00001993, 0.00002118,
    -0.00390426, -0.01155728, -0.00469832, -0.00012354, 0.00475597, 0.01152525,
     0.00384283, -0.00001993, 0.00002118, -0.00390426, -0.01155728, -0.00469832,
     -0.00012354, 0.00475597, 0.01152525, 0.00384283, -0.00001993, 0.00002118,
     -0.00390426, -0.01155728, -0.00469832, -0.00012354, 0.00475597, 0.01152525,
      0.00384283, -0.00001993 };

double fee_expec_J10_re[] = { -0.00075871, 0.00871068, 0.04544427, 0.01727988,
  -0.00024691, -0.01715296, -0.04541500, -0.00869643, 0.00076093, -0.00075871,
   0.00871068, 0.04544427, 0.01727988, -0.00024691, -0.01715296, -0.04541500,
   -0.00869643, 0.00076093, -0.00075871, 0.00871068, 0.04544427, 0.01727988,
   -0.00024691, -0.01715296, -0.04541500, -0.00869643, 0.00076093, -0.00075871,
    0.00871068, 0.04544427, 0.01727988, -0.00024691, -0.01715296, -0.04541500,
    -0.00869643, 0.00076093, -0.00075871, 0.00871068, 0.04544427, 0.01727988,
    -0.00024691, -0.01715296, -0.04541500, -0.00869643, 0.00076093, -0.00075871,
     0.00871068, 0.04544427, 0.01727988, -0.00024691, -0.01715296, -0.04541500,
     -0.00869643, 0.00076093 };

double fee_expec_J10_im[] = { -0.00039296, -0.00770418, 0.00566830, 0.00965868,
  -0.00011722, -0.00945056, -0.00571023, 0.00756251, 0.00038635, -0.00039296,
  -0.00770418, 0.00566830, 0.00965868, -0.00011722, -0.00945056, -0.00571023,
   0.00756251, 0.00038635, -0.00039296, -0.00770418, 0.00566830, 0.00965868,
   -0.00011722, -0.00945056, -0.00571023, 0.00756251, 0.00038635, -0.00039296,
   -0.00770418, 0.00566830, 0.00965868, -0.00011722, -0.00945056, -0.00571023,
    0.00756251, 0.00038635, -0.00039296, -0.00770418, 0.00566830, 0.00965868,
    -0.00011722, -0.00945056, -0.00571023, 0.00756251, 0.00038635, -0.00039296,
    -0.00770418, 0.00566830, 0.00965868, -0.00011722, -0.00945056, -0.00571023,
     0.00756251, 0.00038635 };

double fee_expec_J11_re[] = { 0.00151157, -0.01997306, -0.12771504, -0.06843513,
   0.97021026, -0.06846656, -0.12772713, -0.01998215, 0.00150867, 0.00151157,
   -0.01997306, -0.12771504, -0.06843513, 0.97021026, -0.06846656, -0.12772713,
   -0.01998215, 0.00150867, 0.00151157, -0.01997306, -0.12771504, -0.06843513,
    0.97021026, -0.06846656, -0.12772713, -0.01998215, 0.00150867, 0.00151157,
    -0.01997306, -0.12771504, -0.06843513, 0.97021026, -0.06846656, -0.12772713,
    -0.01998215, 0.00150867, 0.00151157, -0.01997306, -0.12771504, -0.06843513,
     0.97021026, -0.06846656, -0.12772713, -0.01998215, 0.00150867, 0.00151157,
     -0.01997306, -0.12771504, -0.06843513, 0.97021026, -0.06846656, -0.12772713,
     -0.01998215, 0.00150867 };

double fee_expec_J11_im[] = { 0.00077176, 0.01749404, -0.01599882, -0.03795925,
   0.24226442, -0.03801302, -0.01598474, 0.01755485, 0.00077661, 0.00077176,
    0.01749404, -0.01599882, -0.03795925, 0.24226442, -0.03801302, -0.01598474,
     0.01755485, 0.00077661, 0.00077176, 0.01749404, -0.01599882, -0.03795925,
      0.24226442, -0.03801302, -0.01598474, 0.01755485, 0.00077661, 0.00077176,
       0.01749404, -0.01599882, -0.03795925, 0.24226442, -0.03801302, -0.01598474,
        0.01755485, 0.00077661, 0.00077176, 0.01749404, -0.01599882, -0.03795925,
         0.24226442, -0.03801302, -0.01598474, 0.01755485, 0.00077661, 0.00077176,
          0.01749404, -0.01599882, -0.03795925, 0.24226442, -0.03801302,
          -0.01598474, 0.01755485, 0.00077661 };

double fee_expec_interp_J00_re[] = { 0.00493040, 0.04590610, -0.14944787,
   -0.18576541, 0.94742141, -0.18572614, -0.14946621, 0.04584492, 0.00492725,
    0.00081245, 0.12709166, 0.01931603, -0.19565091, 0.99971698, -0.19565220,
     0.01929190, 0.12710924, 0.00081597, 0.00493040, 0.04590610, -0.14944787,
     -0.18576541, 0.94742141, -0.18572614, -0.14946621, 0.04584492, 0.00492725,
      0.00081245, 0.12709166, 0.01931603, -0.19565091, 0.99971698, -0.19565220,
       0.01929190, 0.12710924, 0.00081597, 0.00493040, 0.04590610, -0.14944787,
       -0.18576541, 0.94742141, -0.18572614, -0.14946621, 0.04584492, 0.00492725,
        0.00081245, 0.12709166, 0.01931603, -0.19565091, 0.99971698, -0.19565220,
         0.01929190, 0.12710924, 0.00081597 };

double fee_expec_interp_J00_im[] = { 0.00055451, 0.00748984, -0.02676837,
  -0.03592636, 0.31998856, -0.03593330, -0.02677995, 0.00750165, 0.00056067,
  -0.00059682, -0.03140488, 0.00125730, 0.04073483, -0.02378985, 0.04072817,
   0.00127426, -0.03139654, -0.00059936, 0.00055451, 0.00748984, -0.02676837,
   -0.03592636, 0.31998856, -0.03593330, -0.02677995, 0.00750165, 0.00056067,
   -0.00059682, -0.03140488, 0.00125730, 0.04073483, -0.02378985, 0.04072817,
    0.00127426, -0.03139654, -0.00059936, 0.00055451, 0.00748984, -0.02676837,
    -0.03592636, 0.31998856, -0.03593330, -0.02677995, 0.00750165, 0.00056067,
    -0.00059682, -0.03140488, 0.00125730, 0.04073483, -0.02378985, 0.04072817,
     0.00127426, -0.03139654, -0.00059936 };

double fee_expec_interp_J01_re[] = { 0.00247797, 0.01991664, -0.05318505,
   -0.04664083, -0.00024664, 0.04679301, 0.05313675, -0.02005218, -0.00248211,
    0.00041307, 0.05538775, 0.00682862, -0.04921414, -0.00016112, 0.04920253,
    -0.00690376, -0.05534916, -0.00040728, 0.00247797, 0.01991664, -0.05318505,
    -0.04664083, -0.00024664, 0.04679301, 0.05313675, -0.02005218, -0.00248211,
     0.00041307, 0.05538775, 0.00682862, -0.04921414, -0.00016112, 0.04920253,
     -0.00690376, -0.05534916, -0.00040728, 0.00247797, 0.01991664, -0.05318505,
     -0.04664083, -0.00024664, 0.04679301, 0.05313675, -0.02005218, -0.00248211,
      0.00041307, 0.05538775, 0.00682862, -0.04921414, -0.00016112, 0.04920253,
      -0.00690376, -0.05534916, -0.00040728 };

double fee_expec_interp_J01_im[] = { 0.00028666, 0.00328020, -0.00953737,
   -0.00904765, -0.00001658, 0.00902676, 0.00950959, -0.00325280, -0.00027439,
   -0.00030151, -0.01367064, 0.00047053, 0.01022611, 0.00017165, -0.01026415,
   -0.00042903, 0.01368905, 0.00029765, 0.00028666, 0.00328020, -0.00953737,
   -0.00904765, -0.00001658, 0.00902676, 0.00950959, -0.00325280, -0.00027439,
   -0.00030151, -0.01367064, 0.00047053, 0.01022611, 0.00017165, -0.01026415,
   -0.00042903, 0.01368905, 0.00029765, 0.00028666, 0.00328020, -0.00953737,
   -0.00904765, -0.00001658, 0.00902676, 0.00950959, -0.00325280, -0.00027439,
   -0.00030151, -0.01367064, 0.00047053, 0.01022611, 0.00017165, -0.01026415,
   -0.00042903, 0.01368905, 0.00029765 };

double fee_expec_interp_J10_re[] = { -0.00140196, -0.01416182, 0.03195250,
   0.03664820, -0.00024983, -0.03653320, -0.03199630, 0.01414571, 0.00140719,
    0.00003751, -0.03112300, -0.00767957, 0.05201522, -0.00016745, -0.05202144,
     0.00761246, 0.03113512, -0.00003987, -0.00140196, -0.01416182, 0.03195250,
      0.03664820, -0.00024983, -0.03653320, -0.03199630, 0.01414571, 0.00140719,
       0.00003751, -0.03112300, -0.00767957, 0.05201522, -0.00016745, -0.05202144,
        0.00761246, 0.03113512, -0.00003987, -0.00140196, -0.01416182, 0.03195250,
         0.03664820, -0.00024983, -0.03653320, -0.03199630, 0.01414571, 0.00140719,
          0.00003751, -0.03112300, -0.00767957, 0.05201522, -0.00016745,
          -0.05202144, 0.00761246, 0.03113512, -0.00003987};

double fee_expec_interp_J10_im[] = { -0.00000042, -0.00748140, 0.00614421,
   0.01586605, -0.00001182, -0.01577777, -0.00621149, 0.00737403, -0.00000337,
    0.00117182, 0.01058207, -0.00434158, -0.00480968, 0.00016438, 0.00482214,
     0.00425973, -0.01062581, -0.00116722, -0.00000042, -0.00748140, 0.00614421,
      0.01586605, -0.00001182, -0.01577777, -0.00621149, 0.00737403, -0.00000337,
       0.00117182, 0.01058207, -0.00434158, -0.00480968, 0.00016438, 0.00482214,
        0.00425973, -0.01062581, -0.00116722, -0.00000042, -0.00748140, 0.00614421,
         0.01586605, -0.00001182, -0.01577777, -0.00621149, 0.00737403,
         -0.00000337, 0.00117182, 0.01058207, -0.00434158, -0.00480968, 0.00016438,
          0.00482214, 0.00425973, -0.01062581, -0.00116722 };

double fee_expec_interp_J11_re[] = { 0.00279515, 0.03248527, -0.08990371,
   -0.14546898, 0.94700971, -0.14549550, -0.08988807, 0.03248947, 0.00279365,
   -0.00007598, 0.07146094, 0.02148453, -0.20682597, 0.99976741, -0.20682695,
    0.02150793, 0.07145571, -0.00007486, 0.00279515, 0.03248527, -0.08990371,
    -0.14546898, 0.94700971, -0.14549550, -0.08988807, 0.03248947, 0.00279365,
    -0.00007598, 0.07146094, 0.02148453, -0.20682597, 0.99976741, -0.20682695,
     0.02150793, 0.07145571, -0.00007486, 0.00279515, 0.03248527, -0.08990371,
     -0.14546898, 0.94700971, -0.14549550, -0.08988807, 0.03248947, 0.00279365,
     -0.00007598, 0.07146094, 0.02148453, -0.20682597, 0.99976741, -0.20682695,
      0.02150793, 0.07145571, -0.00007486 };

double fee_expec_interp_J11_im[] = { -0.00000384, 0.01702515, -0.01737993,
   -0.06289211, 0.32120493, -0.06291653, -0.01735828, 0.01707148, 0.00000104,
   -0.00232381, -0.02435042, 0.01207479, 0.01915046, -0.02156680, 0.01914619,
    0.01210498, -0.02433209, -0.00232644, -0.00000384, 0.01702515, -0.01737993,
    -0.06289211, 0.32120493, -0.06291653, -0.01735828, 0.01707148, 0.00000104,
    -0.00232381, -0.02435042, 0.01207479, 0.01915046, -0.02156680, 0.01914619,
     0.01210498, -0.02433209, -0.00232644, -0.00000384, 0.01702515, -0.01737993,
     -0.06289211, 0.32120493, -0.06291653, -0.01735828, 0.01707148, 0.00000104,
     -0.00232381, -0.02435042, 0.01207479, 0.01915046, -0.02156680, 0.01914619,
      0.01210498, -0.02433209, -0.00232644 };


double MWA_analy_expec_J00_re[] = { -0.000000004365, -0.105094352084,
  -0.026591963099, 0.267847379368, 0.893345358913, 0.267847728174,
  -0.026591881348, -0.105094352255, 0.000000011230, 0.000000001347,
   0.150284040279, 0.042977910381, -0.226477767063, 0.893345358913,
   -0.226477788010, 0.042977774708, 0.150284054600, -0.000000003466,
   -0.000000004365, -0.105094352084, -0.026591963099, 0.267847379368,
    0.893345358913, 0.267847728174, -0.026591881348, -0.105094352255,
     0.000000011230, 0.000000001347, 0.150284040279, 0.042977910381,
     -0.226477767063, 0.893345358913, -0.226477788010, 0.042977774708,
      0.150284054600, -0.000000003466, -0.000000004365, -0.105094352084,
      -0.026591963099, 0.267847379368, 0.893345358913, 0.267847728174,
      -0.026591881348, -0.105094352255, 0.000000011230, 0.000000001347,
       0.150284040279, 0.042977910381, -0.226477767063, 0.893345358913,
       -0.226477788010, 0.042977774708, 0.150284054600, -0.000000003466 };

double MWA_analy_expec_J11_re[] = { 0.000000000000, -0.058820673906,
  -0.021048251099, 0.259656170546, 1.000000000000, 0.259656508684, -0.021048186391,
   -0.058820674002, 0.000000000000, -0.000000000000, 0.084113069363,
    0.034018167295, -0.219551708320, 1.000000000000, -0.219551728627,
     0.034018059906, 0.084113077379, -0.000000000000, 0.000000000000,
     -0.058820673906, -0.021048251099, 0.259656170546, 1.000000000000,
      0.259656508684, -0.021048186391, -0.058820674002, 0.000000000000,
      -0.000000000000, 0.084113069363, 0.034018167295, -0.219551708320,
       1.000000000000, -0.219551728627, 0.034018059906, 0.084113077379,
       -0.000000000000, 0.000000000000, -0.058820673906, -0.021048251099,
        0.259656170546, 1.000000000000, 0.259656508684, -0.021048186391,
        -0.058820674002, 0.000000000000, -0.000000000000, 0.084113069363,
         0.034018167295, -0.219551708320, 1.000000000000, -0.219551728627,
          0.034018059906, 0.084113077379, -0.000000000000 };

double MWA_analy_expec_J01_re[] = { 0.000000002196, 0.045782069703,
  0.009458468353, -0.067366319296, 0.000000000000, 0.067366407025, -0.009458439275,
   -0.045782069777, 0.000000005649, -0.000000000678, -0.065467974928,
   -0.015286769304, 0.056961444258, 0.000000000000, -0.056961449526,
    0.015286721047, 0.065467981167, -0.000000001744, 0.000000002196,
     0.045782069703, 0.009458468353, -0.067366319296, 0.000000000000,
      0.067366407025, -0.009458439275, -0.045782069777, 0.000000005649,
      -0.000000000678, -0.065467974928, -0.015286769304, 0.056961444258,
       0.000000000000, -0.056961449526, 0.015286721047, 0.065467981167,
       -0.000000001744, 0.000000002196, 0.045782069703, 0.009458468353,
       -0.067366319296, 0.000000000000, 0.067366407025, -0.009458439275,
       -0.045782069777, 0.000000005649, -0.000000000678, -0.065467974928,
       -0.015286769304, 0.056961444258, 0.000000000000, -0.056961449526,
        0.015286721047, 0.065467981167, -0.000000001744};
